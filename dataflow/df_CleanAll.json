{
	"name": "df_CleanAll",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CleanAll",
						"type": "DatasetReference"
					},
					"name": "Source"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "df_Cleaned_Output",
						"type": "DatasetReference"
					},
					"name": "Sink"
				}
			],
			"transformations": [
				{
					"name": "RenameHeaders"
				},
				{
					"name": "SelectColumns"
				},
				{
					"name": "ValidateIdNumbers"
				},
				{
					"name": "FixLeadingZeros"
				},
				{
					"name": "RemoveLandlinesFromCell"
				},
				{
					"name": "RemoveDuplicateNumbers"
				},
				{
					"name": "CreateAssetDecription"
				},
				{
					"name": "RemoveUnusedColumns"
				},
				{
					"name": "RemoveDuplicateEntries"
				},
				{
					"name": "RemoveHeadersAsRow"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Column_1 as string,",
				"          Column_2 as string,",
				"          Column_3 as string,",
				"          Column_4 as string,",
				"          Column_5 as string,",
				"          Column_6 as string,",
				"          Column_7 as string,",
				"          Column_8 as string,",
				"          Column_9 as string,",
				"          Column_10 as string,",
				"          Column_11 as string,",
				"          Column_12 as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> Source",
				"Source derive(Account_No = Column_1,",
				"          Full_Name = Column_2,",
				"          Full_Surname = Column_3,",
				"          Id_No = Column_4,",
				"          Cell_No = Column_5,",
				"          Home_No = Column_6,",
				"          Work_No = Column_7,",
				"          Full_Adress = Column_8,",
				"          Full_Balance = Column_9,",
				"          Product_Type = Column_10,",
				"          Product_Amount = Column_11,",
				"          Product_Balance = Column_12) ~> RenameHeaders",
				"RenameHeaders select(mapColumn(",
				"          Account_No,",
				"          Full_Name,",
				"          Full_Surname,",
				"          Id_No,",
				"          Cell_No,",
				"          Home_No,",
				"          Work_No,",
				"          Full_Adress,",
				"          Full_Balance,",
				"          Product_Type,",
				"          Product_Amount,",
				"          Product_Balance",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectColumns",
				"SelectColumns derive(Id_No = iif(\r",
				"    length(regexReplace(trim(Id_No), '[^0-9]', '')) == 13,\r",
				"    regexReplace(trim(Id_No), '[^0-9]', ''),\r",
				"    Id_No\r",
				")) ~> ValidateIdNumbers",
				"ValidateIdNumbers derive(Cell_No = iif(\r",
				"    isNull(Cell_No) || trim(Cell_No) == '',\r",
				"    '',\r",
				"    iif(\r",
				"        startsWith(Cell_No, '0027'),\r",
				"        concat('0', substring(Cell_No, 5)),\r",
				"        iif(\r",
				"            startsWith(Cell_No, '27'),\r",
				"            concat('0', substring(Cell_No, 3)),\r",
				"            iif(\r",
				"                length(Cell_No) > 10,\r",
				"                ' ',\r",
				"                iif(\r",
				"                    length(Cell_No) < 10,\r",
				"                    iif(\r",
				"                        startsWith(Cell_No, '0'),\r",
				"                        Cell_No,\r",
				"                        concat('0', Cell_No)\r",
				"                    ),\r",
				"                    Cell_No\r",
				"                )\r",
				"            )\r",
				"        )\r",
				"    )\r",
				"),",
				"          Home_No = iif(\r",
				"    isNull(Home_No) || trim(Home_No) == '',\r",
				"    '',\r",
				"    iif(\r",
				"        startsWith(Home_No, '0027'),\r",
				"        concat('0', substring(Home_No, 5)),\r",
				"        iif(\r",
				"            startsWith(Home_No, '27'),\r",
				"            concat('0', substring(Home_No, 3)),\r",
				"            iif(\r",
				"                length(Home_No) > 10,\r",
				"                ' ',\r",
				"                iif(\r",
				"                    length(Home_No) < 10,\r",
				"                    iif(\r",
				"                        startsWith(Home_No, '0'),\r",
				"                        Home_No,\r",
				"                        concat('0', Home_No)\r",
				"                    ),\r",
				"                    Home_No\r",
				"                )\r",
				"            )\r",
				"        )\r",
				"    )\r",
				"),",
				"          Work_No = iif(\r",
				"    isNull(Work_No) || trim(Work_No) == '',\r",
				"    '',\r",
				"    iif(\r",
				"        startsWith(Work_No, '0027'),\r",
				"        concat('0', substring(Work_No, 5)),\r",
				"        iif(\r",
				"            startsWith(Work_No, '27'),\r",
				"            concat('0', substring(Work_No, 3)),\r",
				"            iif(\r",
				"                length(Work_No) > 10,\r",
				"                ' ',\r",
				"                iif(\r",
				"                    length(Work_No) < 10,\r",
				"                    iif(\r",
				"                        startsWith(Work_No, '0'),\r",
				"                        Work_No,\r",
				"                        concat('0', Work_No)\r",
				"                    ),\r",
				"                    Work_No\r",
				"                )\r",
				"            )\r",
				"        )\r",
				"    )\r",
				")) ~> FixLeadingZeros",
				"FixLeadingZeros derive(Cell_No = iif(\r",
				"  (\r",
				"    startsWith(Cell_No, '01') || startsWith(Cell_No, '02') ||\r",
				"    startsWith(Cell_No, '03') || startsWith(Cell_No, '04') ||\r",
				"    startsWith(Cell_No, '05')\r",
				"  ),\r",
				"  '',\r",
				"  Cell_No\r",
				")\r",
				",",
				"          Home_No = iif(\r",
				"  (\r",
				"    startsWith(Cell_No, '01') || startsWith(Cell_No, '02') ||\r",
				"    startsWith(Cell_No, '03') || startsWith(Cell_No, '04') ||\r",
				"    startsWith(Cell_No, '05')\r",
				"  )\r",
				"  && (isNull(Home_No) || trim(Home_No) == ''),\r",
				"  Cell_No,\r",
				"  Home_No\r",
				")\r",
				",",
				"          Work_No = iif(\r",
				"  (\r",
				"    startsWith(Cell_No, '01') || startsWith(Cell_No, '02') ||\r",
				"    startsWith(Cell_No, '03') || startsWith(Cell_No, '04') ||\r",
				"    startsWith(Cell_No, '05')\r",
				"  )\r",
				"  && !(isNull(Home_No) || trim(Home_No) == '')\r",
				"  && (isNull(Work_No) || trim(Work_No) == ''), \r",
				"  Cell_No,\r",
				"  Work_No\r",
				")\r",
				") ~> RemoveLandlinesFromCell",
				"RemoveLandlinesFromCell derive(Cell_No = iif(\r",
				"    Cell_No == '' || isNull(Cell_No),\r",
				"    '', \r",
				"    Cell_No\r",
				")\r",
				",",
				"          Home_No = iif(\r",
				"    !isNull(Cell_No) && trim(Cell_No) != '' &&\r",
				"    Cell_No == Home_No,\r",
				"    '',\r",
				"    Home_No\r",
				")\r",
				",",
				"          Work_No = iif(\r",
				"    (!isNull(Cell_No) && trim(Cell_No) != '' && Cell_No == Work_No) ||\r",
				"    (!isNull(Home_No) && trim(Home_No) != '' && Home_No == Work_No),\r",
				"    '', \r",
				"    Work_No\r",
				")\r",
				") ~> RemoveDuplicateNumbers",
				"RemoveDuplicateNumbers derive(Asset_Description = concat(\r",
				"    'Product_Type: ', Product_Type, '; ',\r",
				"    'Product_Amount: ', Product_Amount, '; ',\r",
				"    'Product_Balance: ', Product_Balance, ';'\r",
				")\r",
				") ~> CreateAssetDecription",
				"CreateAssetDecription select(mapColumn(",
				"          Account_No,",
				"          Full_Name,",
				"          Full_Surname,",
				"          Id_No,",
				"          Cell_No,",
				"          Home_No,",
				"          Work_No,",
				"          Full_Adress,",
				"          Full_Balance,",
				"          Asset_Description",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> RemoveUnusedColumns",
				"RemoveHeadersAsRow aggregate(groupBy(Account_No),",
				"     Full_Name = first(Full_Name)\r",
				",",
				"          Full_Surname = first(Full_Surname),",
				"          Id_No = first(Id_No),",
				"          Cell_No = first(Cell_No),",
				"          Home_No = first(Home_No),",
				"          Work_No = first(Work_No),",
				"          Full_Adress = first(Full_Adress),",
				"          Full_Balance = first(Full_Balance),",
				"          Asset_Description = first(Asset_Description)) ~> RemoveDuplicateEntries",
				"RemoveUnusedColumns filter(!isNull( toInteger(Account_No) )\r",
				") ~> RemoveHeadersAsRow",
				"RemoveDuplicateEntries sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> Sink"
			]
		}
	}
}